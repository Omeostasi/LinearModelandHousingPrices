---
title: "exploratoryDataAnalysis"
output:
  html_document: default
  pdf_document: default
---

# Load libraries
```{r}
library(tidyverse)
library(dplyr)
library(patchwork)
library(car)
```


# Load data
```{r}
data <- read.csv("data/AmesHousing.csv", header = TRUE, sep = ";")
```

# EDA
```{r}
source("src/edaFunctions.R")
```


## Select chosen variables
For this analysis, we are using the Ames Housing dataset to model residential property sales. We have selected a subset of variables that capture size, quality, age, and location characteristics.

Target Variable
SalePrice: The property's sale price in US dollars. This is the response variable we aim to predict.

Explanatory Variables
Size & Space

GrLivArea: Above grade (ground) living area square footage.

TotalBsmtSF: Total square footage of the basement area.

GarageArea: Size of the garage in square feet.

LotArea: Lot size in square feet.

Condition & Age

OverallQual: Rates the overall material and finish of the house (1 = Very Poor, 10 = Very Excellent).

YearBuilt: Original construction date.

YearRemodAdd: Remodel date (same as construction date if no remodeling or additions).

Location & Style

Neighborhood: Physical locations within Ames city limits. In the US market, this is a strong proxy for school districts, distance to the university, and neighborhood prestige, which drastically affects value independent of the house itself.

HouseStyle: Describes the vertical layout of the house. Common types include:

* 1-Story: "Ranch" style (all ground level).

* 2-Story: Bedrooms typically upstairs.

* 1.5-Story: Older homes with converted attics (slanted ceilings).

* Split-Level: Staggered floors with short flights of stairs.


store them
```{r}
explanatoryVars <- c("Gr.Liv.Area", "Total.Bsmt.SF", "Garage.Area", "Lot.Area", 
                      "Overall.Qual", "Year.Built", "Year.Remod.Add", 
                      "Neighborhood", "House.Style")

targetVar <- c("SalePrice")

idVars <-  c("Order","PID")
```

```{r}
df <- data[, explanatoryVars]

target <- data[targetVar]
```

## Missing values
```{r}
missingValues <- colSums(is.na(df))
as.data.frame(missingValues)
```

```{r}
missingValuesTarget <- colSums(is.na(target))
as.data.frame(missingValuesTarget)
```

## STUDY numerical variables

Explanatory variables
```{r}
numDescription <- numerical_descriptive(df)
numDescription
```

Target Variables
```{r}
numerical_descriptive(target)
```

## Study discrete variables

```{r}
categoricalDescription <- categorical_summary(df)
categoricalDescription
```


## Distributions and Histograms

```{r, fig.height=20, fig.width=12}
for (name in explanatoryVars) {
  if (is.numeric(df[[name]])) {
    
    # To allow for dinamic binwidth based on variable range
    var_range <- max(df[[name]], na.rm = TRUE) - min(df[[name]], na.rm = TRUE)
    dynamic_binwidth <- var_range / 30
    
    # 2. Create the plot
    p <- ggplot(df, aes_string(x = name)) +
      

      geom_histogram(aes(y = ..density..), 
                     binwidth = dynamic_binwidth, 
                     fill = "#69b3a2",   # A nicer teal color
                     color = "white",    # White borders separate bars clearly
                     alpha = 0.7) +      # Slight transparency
      
      # DENSITY LINE
      geom_density(color = "#FF6666", size = 1.2, fill = "#FF6666", alpha = 0.2) +
      
      # labels
      labs(title = paste("Distribution of", name),
           subtitle = paste("Mean:", round(mean(df[[name]], na.rm=TRUE), 2), 
                            "| SD:", round(sd(df[[name]], na.rm=TRUE), 2)),
           x = name, 
           y = "Density") +
      
      theme_minimal() + 
      
      
      scale_y_continuous(expand = expansion(mult = c(0, 0.1)))
    
    print(p)
    ggsave(filename = paste0("plots/distribution_", name, ".png"), plot = p, width = 8, height = 6)
    
  }
}
```
### Categorical variables
Plot Neighborhood
```{r}

barplot(table(df$Neighborhood), main="Distribution of Neighborhood", 
        xlab="Neighborhood", ylab="Count", las=2, col="lightblue", cex.names=0.5)


```
```{r}

barplot(table(df$House.Style), main="Distribution of House.Style", 
        xlab="House.Style", ylab="Count", las=2, col="lightblue", cex.names=0.8)


```

## Check for lienarity

```{r, fig.height=20, fig.width=12}
df <- data[c(explanatoryVars, targetVar)]
wrap_plots(pairwiseplot_for_linearity(df, "SalePrice"), ncol = 2, nrow = 4)
```


### Linearity for categorical variables
```{r}
for (catVar in c("Neighborhood", "House.Style")) {
  p <- ggplot(df, aes(x = reorder(.data[[catVar]], SalePrice, FUN = median), 
                      y = SalePrice)) +
    geom_boxplot(fill = "#69b3a2", alpha = 0.7) +
    stat_summary(fun = mean, geom = "point", shape = 20, size = 4, color = "#FF6666", fill = "#FF6666") +
    labs(title = paste("SalePrice by", catVar),
         x = catVar,
         y = "SalePrice") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
  
  print(p)
  ggsave(filename = paste0("plots/linearity_SalePrice_vs_", catVar, ".png"), plot = p, width = 8, height = 6)
}
```


##  Correlation Matrix

```{r}
plot_correlation_matrix(df)
# save plot
ggsave(filename = "plots/correlation_matrix.png", width = 8, height = 6)
```

 
